# Заметки по разработке на Arduino Uno

## 1. Внешние прерывания

В **Arduino Uno** предусмотрено два внешних прерывания:

1. **int0** - прерывание на digital pin 2
2. **int1** - прерывание на digital pin 3

Чтобы прерывания начали обрабатываться, нужно проделать 3 действия:

1. Разрешить прерывание
2. Задать режим прерывания
3. Подключить обработчик прерывания

### 1.1 Разрешаем прерывание

Для того, чтобы разрешить прерыванию выполняться мы должны воспользоваться регистром **EIMSK** (External Interrupt Mask). Младший бит управляет прерыванием **int0**, следующий - прерыванием **int1**.

```c++
EIMSK = 0b00000000; // Не разрешены никакие внешние прерывания
EIMSK = 0b00000001; // Разрешено внешнее прерывание int0
EIMSK = 0b00000010; // Разрешено внешнее прерывание int1
EIMSK = 0b00000011; // Разрешены внешние прерывания int0 и int1
```

### 1.2 Задаем режим прерывания

Существует 4 режима работы прерываний:

- 0 - **LOW** прерывание, срабатывает, когда на входе pin’а LOW напряжение
- 1 - **CHANGE** прерывание, срабатывает при любом изменении состояния входа pin’а
- 2 - **FALLING** прерывания, когда идет спад напряжения
- 3 - **RISING** прерывание, когда идет подъем напряжения

Для управления режимом прерывания существует регистр **EICRA** (External Interupt Control Register A). Младшие 2 бита отвечают за режим прерывания **int0**, следующие - за режим прерывания **int1**.

```c++
EICRA = 0b00000000; // Оба прерывания работают в режиме LOW
EICRA = 0b00000110; // Прерывание int0 работает в режиме FALLING, int1 - в режиме CHANGE
EICRA = 0b00001101; // Прерывание int0 работает в режиме CHANGE, int1 - в режиме RISING
```

### 1.3 Подключаем обработчик прерывания

Для того, чтобы как-то реагировать на произошедшее прерывание мы должны подключить обработчик **ISR** (Interrupt Service Routine) с аргументом, соответствующим прерыванию

```c++
ISR(INT0_vect)
{
// Обработчик прерывания int0
}

ISR(INT1_vect)
{
// Обработчик прерывания int1
}
```

### 1.4 Финальный код и другие заметки по внешним прерываниям

В конце концов, если мы хотим, чтобы наше **Arduino Uno** реагировала на понижение напряжения (режим **FALLING**) на входе digital pin'а 2 (прерывание **int0**), то можно набрасать примерно такой код:

```c++
void setup()
{
  EIMSK = 0b00000001; // Разрешили прерывание int0
  EICRA = 0b00000010; // Установили режим прерывания при понижении напряжения (FALLING)
}

void loop()
{
  // Основной цикл программы
}

ISR(INT0_vect)
{
  // Какое-то действие при обработке прерывания (Включаем сигнализацию)
}
```

Также есть регистр **EIFR** (External Interrupt Flag Register) - флаг обработки прерывания, показывает, обработано прерывание или нет. _**По его работе мало информации**_.
